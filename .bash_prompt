bash_prompt()
{
    local exit_code=$?

    # Color support detection from Ubuntu
    if [ -x /usr/bin/tput ]
    then
        local reset='\[\e[0m\]'
        local red='\[\e[1;31m\]'
        local green='\[\e[1;32m\]'
        local orange='\[\e[1;33m\]'
        local blue='\[\e[1;34m\]'
    fi

    # set variable identifying the chroot you work in (used in the prompt below)
    if [ -z "$debian_chroot" ] && [ -r /etc/debian_chroot ]
    then
        local debian_chroot=$(cat /etc/debian_chroot)
    elif [ -r /etc/jail ]
    then
        local debian_chroot=$(cat /etc/jail)
    fi

    # set a fancy prompt (non-color, overwrite the one in /etc/profile)
    PS1="${orange}\${debian_chroot:+(\$debian_chroot)}${reset}"

    # Red user if root, orange if su
    if [ "$USER" == 'root' ]
    then
        PS1="$PS1$red"
    elif [ -n "$SUDO_USER" ]
    then
        PS1="$PS1$orange"
    else
        PS1="$PS1$green"
    fi
    PS1="${PS1}\u${reset}@"

    # Red host if SSH
    if [ -n "$SSH_CONNECTION" ]
    then
        PS1="$PS1$red"
    else
        PS1="$PS1$green"
    fi
    PS1="${PS1}\h${reset}:${blue}\w${reset}"

    # Git branch
    if [ -f /etc/bash_completion.d/git ]
    then
        PS1="${PS1}\$(__git_ps1 ' (%s)')"
    fi
    
    separator="\\$"
    if [ $exit_code -ne 0 ]
    then
        separator="${red}${separator}${reset}"
    fi

    PS1="${PS1}$separator "
}
